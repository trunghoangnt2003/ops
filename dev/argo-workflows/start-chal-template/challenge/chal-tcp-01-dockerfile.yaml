## Challenge TCP 01 Dockerfile
---
apiVersion: v1
kind: Service
metadata:
  namespace: ${CHALLENGE_NAME}
  name: ${CHALLENGE_NAME}-svc
  labels:
    ctf/kind: "challenge"
spec:
  type: NodePort
  selector:
    app: ${CHALLENGE_NAME}
  ports:
    - name: tcp-challenge-nodeport
      protocol: TCP
      port: 3333
      targetPort: ${CONTAINER_PORT}
---
apiVersion: batch/v1
kind: Job
metadata:
  name: ${CHALLENGE_NAME}-job
  namespace: ${CHALLENGE_NAME}
spec:
  ttlSecondsAfterFinished: ${CHALLENGE_TIMEOUT_SECONDS}
  activeDeadlineSeconds: ${CHALLENGE_TIMEOUT_SECONDS}
  template:
    metadata:
      labels:
        app: ${CHALLENGE_NAME}
        ctf/kind: "challenge"
    spec:
      restartPolicy: Never
      automountServiceAccountToken: false               # ğŸš« KhÃ´ng gáº¯n token API server
      containers:
        - name: challenge-01
          image: "${CONTAINER_IMAGE}"
          ports:
            - containerPort: ${CONTAINER_PORT}
          securityContext:
            allowPrivilegeEscalation: false             # ğŸš« KhÃ´ng cho escalate privilege
            privileged: false                           # ğŸš« KhÃ´ng cho privileged 
            runAsNonRoot: true                          # ğŸš« KhÃ´ng cháº¡y root
            runAsUser: 1000                             # ğŸš« Cháº¡y vá»›i user 1000
            readOnlyRootFilesystem: false               # ğŸš« Read only root filesystem
            capabilities: 
              drop: ["ALL"]                             # ğŸš« Bá» má»i Linux capabilities
          resources:
            requests:
              memory: "32Mi"
              cpu: "0"
            limits:
              memory: "64Mi"
              cpu: "0.1"
          imagePullPolicy: IfNotPresent
      imagePullSecrets:
        - name: global-regcred